<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />

  <title>Menu</title>
  <!-- BS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- CSS Files -->
  <link rel="stylesheet" href="/css/backstage_share_frame.css">
  <link rel="stylesheet" href="/css/menu_pic_step.css">
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <!-- chart.js圖表樣式 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
  <!-- title ICON -->
  <link rel="icon" type="image/x-icon" href="/pic/favicon32.ico">
  <!-- 引進 SweetAlert -->
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>
  <div class="container-fluid p-0 d-flex justify-content-center align-items-center vh-100">
    <div class="container backstage_body row align-items-center justify-content-between">
      <div class="col-2 backstage_nav card p-0 ">
        <div class="d-flex flex-column h-100 pb-2 pt-4 ">

          <div class="d-flex align-items-center justify-content-center flex-grow-1 status-info">
            <!-- Modal for opening or not -->
            <div class="avatar avatar-xl position-relative" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
              <!-- 上線中statusLight 是 bg-success，休息是 bg-warning-->
              <div class="status">
                <div class=" statusLight"></div>
              </div>
              <img src="/pic/mosa2.jpg" alt="" class="rounded-circle ">
            </div>
          </div>

          <!-- Modal -->
          <!-- <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="staticBackdropLabel">選擇營業狀態</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>


                <div class="modal-body">
                  <div class="form-check fs-4">
                    <input class="form-check-input custom-radio" type="radio" name="flexRadioDefault"
                      id="flexRadioDefault1" checked />
                    <label class="form-check-label" for="flexRadioDefault1"> 營業中 </label>
                    <span class="checkmark"></span>
                  </div>

                  <div class="form-check mt-3 fs-4">
                    <input class="form-check-input custom-radio" type="radio" name="flexRadioDefault"
                      id="flexRadioDefault2" />
                    <label class="form-check-label" for="flexRadioDefault2"> 閉店中 </label>
                    <span class="checkmark"></span>
                  </div>
                </div>


                <div class="modal-footer">
                  <button type="button" class="btn btn-light btn-outline-secondary" data-bs-dismiss="modal">關閉</button>
                  <button type="button" class="btn btn-success">確認</button>
                </div>
              </div>
            </div>
          </div> -->

          <!-- 商家名稱 -->
          <p class="mb-0 mt-2 mb-4 text-center fw-bold fs-6" id="welcomeText"></p>

          <a href="/backstage/clientinfo" class="d-flex align-items-center py-2 mt-2 flex-grow-1 nav_a">
            <i class="bi bi-info-circle  text-sm  me-3 fs-5 fw-bold "></i>
            <span class="nav-link-text ms-1">店家資訊</span>
          </a>
          <a href="/backstage/businessAnalytics/all" class="d-flex align-items-center py-2 flex-grow-1 nav_a">
            <i class="bi bi-pie-chart  text-sm  me-3 fs-5 fw-bold "></i>
            <span class="nav-link-text ms-1">平台分析</span>
          </a>
          <a href="/backstage/businessAnalytics/self" class="d-flex align-items-center py-2 flex-grow-1 nav_a">
            <i class="bi bi-graph-up-arrow  text-sm  me-3 fs-5 fw-bold "></i>
            <span class="nav-link-text ms-1">本店分析</span>
          </a>
          <a href="/backstage/menu" class="d-flex align-items-center py-2 flex-grow-1 nav_a choose">
            <i class="bi bi-clipboard  text-sm  me-3 fs-5 fw-bold "></i>
            <span class="nav-link-text ms-1">菜單專區</span>
          </a>
          <a href="/backstage/activity" class="d-flex align-items-center py-2 flex-grow-1 nav_a">
            <i class="bi bi-megaphone  text-sm  me-3 fs-5 fw-bold "></i>
            <span class="nav-link-text ms-1">活動專區</span>
          </a>

          <!-- 下面兩個按鈕 -->
          <div class=" mt-3 px-2 py-2 btnContainer">
            <hr>
            <button onclick="window.location.href='/restaurant/14'" target="_blank"
              class="btn btn-light btn-sm w-100 mb-3 fw-bold rounded-3"><i
                class="bi bi-house me-3 btn_padding "></i>我的餐廳</button>
            <button class="btn btn-warning btn-sm  w-100 fw-bold  mb-3 rounded-3" type="button"><i
                class="bi bi-box-arrow-left me-3 btn_padding "></i><span class="ms-3">登出</span> </button>

          </div>

        </div>
      </div>
      <div class="col-10 backstage_main_area" id="papa">
        <!-- 菜單左側 -->
        <!-- 上傳檔案&下載檔案container-fluid -->

        <div class="row ">


          <!-- 上傳檔案 -->
          <div class="col-12   mb-4 px-0 me-sm-3" id="card2">
            <div class="card-header ms-3">菜單上傳步驟<i class="bi bi-info-circle  opacity-10 ms-2 fw-bold "></i></div>
            <div class="arrows">


              <div class="arrow step1  py-1 px-3 me-2">
                <span class="text-secondary">1.下載範例</span>
                <br>
                <from class="input-group  row  m-0 p-0 ">

                  <label for="download" class="col-form-label form-control col-9">菜單範例下載.csv</label>

                  <button class="btn btn-outline-secondary col-3" type="button" id=""
                    onclick="downloadFile('/download/menu(範例).csv')">下載</button>

                  <!-- <button class="btn btn-outline-secondary" type="button" >下載</button> -->

                </from>
              </div>
              <div class="arrow step2  py-1 px-3 me-2">
                <span class="text-secondary">2.上傳菜單表單</span>
                <!-- <form class="input-group mb-2" id="menuForm" enctype="multipart/form-data">

                  <input type="file" class="form-control" name="menuFile" id="menuFile">
                  <button class="btn btn-outline-secondary" type="button" id="insertmenu">上傳</button>

                </form> -->
                <input type="file" name="file1" id="file1" class="inputFile">
                <div class="d-flex justify-content-center">
                  <div type="text" name="file-name1" id="file-name1" class="file-name click_here py-1"
                    readonly="readonly">
                    <span id="span1" class="pt-3">點擊選擇檔案</span>
                  </div>
                  <input type="button" id="csvFileBtn1" class="btn btn-outline-secondary"
                    style="border-radius:0px 10px 10px 0px" value="上傳">
                </div>

              </div>
              <div class="arrow step3 py-1 px-3">
                <span class="text-secondary">3.上傳菜單圖片</span>
                <form class="input-group justify-content-center" id="imgForm" enctype="multipart/form-data"
                  method="POST">
                  <!-- <input type="file" name="image_files[]" id="image_files" multiple class="form-control">

                  <button class="btn btn-outline-secondary" type="submit" id="addImage">上傳</button> -->
                  <input type="file" name="file2" id="image_files" class="inputFile" multiple style="display:none;">
                  <div class="d-flex">
                    <div type="text" name="file-name2" id="file-name2" class="file-name click_here py-1"
                      readonly="readonly">
                      <span id="span2" class="pt-3">點擊選擇圖片</span>
                    </div>
                    <input type="submit" id="addImage" class="btn btn-outline-secondary"
                      style="border-radius:0px 10px 10px 0px" value="上傳">
                  </div>
                </form>
              </div>

            </div>

          </div>

          <!-- 菜單list -->

          <div class="mosa_card col-12  me-sm-3" id="card3" style=" min-width: 411px; overflow: auto;">
            <div class="card-header d-flex justify-content-between align-items-center mb-2">
              <h5>菜單資料</h5>
              <button id="turncate" type="button" class="delMenu btn btn-outline-secondary " title="表單清除">
                <i class="bi bi-folder-x"></i>
              </button>
            </div>


            <div class="card-body px-0 pt-0 pb-2">
              <div class="table-responsive p-0 scrollbar" style="height: 480px; min-width: 555px; overflow: auto;"
                id="menu_table_tbody">
                <table class="table align-items-center mb-0">
                  <thead>
                    <tr>
                      <th class="text-uppercase text-secondary fs-6 font-weight-bolder opacity-7 px-4">
                        名稱
                      </th>
                      <th
                        class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7  align-middle text-center">
                        分類</th>
                      <th
                        class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7  align-middle text-center">
                        價格
                      </th>
                      <th
                        class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7  align-middle text-center">
                        Uber
                      </th>
                      <th
                        class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7  align-middle text-center">
                        Panda
                      </th>
                      <th
                        class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7  align-middle text-center">
                        圖片預覽
                      </th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"
                        id="DESC">
                        上傳時間<i class="bi bi-arrows-expand"></i></th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">

                      </th>

                    </tr>
                  </thead>
                  <tbody>

                    <!-- <tr>
                      <td class="align-middle text-center">
                        <div class="d-flex px-3 py-0">
                          <div class="d-flex flex-column justify-content-center">
                            <span name="menu_id" class="mb-0 text-sm" style="display: none;">ID</span>
                            <span name="menu_name" class="mb-0 text-sm">滿載而鮭</span>
                            
                          </div>
                        </div>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_type" class="text-secondary text-xs font-weight-bold">鮭魚</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_price" class="text-secondary text-xs font-weight-bold">$100</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_uber" class="text-secondary text-xs font-weight-bold">$100</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_panda" class="text-secondary text-xs font-weight-bold">$100</span>
                      </td>
                      <td class="align-middle text-center">
                        <img name="menu_picture" src="../public/pic/小小兵.png" alt="profile_image"
                          class="h-100 border-radius-round ">
                        <span name="menu_pictureName" class="text-secondary text-xs font-weight-bold">鮭魚.jpg</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_editdate" class="text-secondary text-xs font-weight-bold">23/04/18</span>
                      </td>
                      <td class=" align-middle text-end gx-1">
                        <button class="btn btn-outline-warning  ">
                          <a href="javascript:;" class="text-secondary font-weight-bold text-xs px-1 "
                            data-toggle="tooltip" data-original-title="Edit user">
                            編輯
                          </a></button>
                        <button class="btn btn-outline-danger">
                          <a href="javascript:;" class="text-withe font-weight-bold text-xs px-1 " data-toggle="tooltip"
                            data-original-title="Edit user">
                            刪除
                          </a></button>
                      </td>
                    </tr> -->
                    <!-- 第一個以下的tr -->

                  </tbody>
                </table>
              </div>
            </div>
          </div>





        </div>


      </div>
    </div>
  </div>
  </div>

  <!-- Modal 編輯-->
  <div class="modal fade" id="myModal_V2">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">餐點編輯</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <div class="upload-container d-flex justify-content-center"
            style="background-color: rgb(231, 230, 229);height: 100px; width: auto; ">
            <img id="editImg" src="../upload/shop_id_14/menu_img/tim_00.png" alt="" style="height: 100%;width: auto; ">
            <input type="file" multiple="multiple" name="file" id="file_upload" style="display: none;">
            <span>
              <i class="bi bi-image " id="uploadIcon"></i>
            </span>
          </div>
          <form>
            <div class="mb-3 ">
              <span id="editId" style="display: none;" value="">111</span>
              <label for="recipient-name" class="col-form-label ">餐點名稱:</label>
              <input type="text" class="form-control " id="editName" value="">
            </div>
            <div class="mb-3 ">
              <label for="recipient-name" class="col-form-label ">價格:</label><br>
              <span>原價格</span><input id="editPrice" name="editPrice" type="text" class="form-control " value=""
                required>

              <span>Uber</span><input id="editUber" name="editUber" type="text" class="form-control " value="" required>
              <span>Panda</span><input id="editPanda" name="editPanda" type="text" class="form-control " value=""
                required>
            </div>
            <div class="mb-3 ">
              <label for="recipient-name" class="col-form-label ">類別:</label>
              <input type="text" class="form-control " id="editType" value="">
            </div>
          </form>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="btnEdit">確認</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        </div>

      </div>
    </div>
  </div>

  <!-- Modal 刪除-->
  <div class="modal fade" id="myModal_V3">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">刪除餐點</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">

          <form>
            <div class="mb-3 ">
              <span id="delId" style="display: none;">111</span>
              <!-- <label for="recipient-name" class="col-form-label ">確定要刪除此活動嗎?</label> -->
              <label for="recipient-name" class="col-form-label ">確定要刪除嗎?</label>
              <span id="delName" style="text-decoration: line-through;"></span>
            </div>
          </form>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="btnDelete">確認</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">取消</button>
        </div>

      </div>
    </div>
  </div>

  </script>

  <script>
    function downloadFile(url) {
      const link = document.createElement('a');
      link.href = url;
      link.download = url.substring(url.lastIndexOf('/') + 1);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
  <script src="/js/menu/menu_pic_height.js"></script>

  <script>
    $(document).ready(function () {

      //get全部
      function getMenuList() {
        $.ajax({
          url: "/menuSelect/default",//想要獲得3000要在sever那邊先開放
          type: "GET",
          success: function (Mlist) {
            //檢查是否有進來
            console.log('我是getMenuList-success')
            //檢查有沒有url資料
            console.log(Mlist)
            console.log(Mlist[0])
            console.log(Mlist[1][0])
            $('tbody').empty();
            $.each(Mlist[0], function (index, myMenulist) {

              $('tbody').append(
                `  <tr>
                      <td class="align-middle text-center">
                        <div class="d-flex px-3 py-0">
                          <div class="d-flex flex-column justify-content-center">
                            <span name="menu_id" class="mb-0 text-sm" style="display: none;">${myMenulist.menu_id}</span>
                            <span name="menu_name" class="mb-0 text-sm">${myMenulist.menu_name}</span>
  
                          </div>
                        </div>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_type" class="text-secondary text-xs font-weight-bold">${myMenulist.menu_type}</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_price" class="text-secondary text-xs font-weight-bold">${myMenulist.menu_price}</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_uber" class="text-secondary text-xs font-weight-bold">${myMenulist.menu_uber ? myMenulist.menu_uber : ""}</span>
                        </td>
                        <td class="align-middle text-center">
                          <span name="menu_panda" class="text-secondary text-xs font-weight-bold">${myMenulist.menu_panda ? myMenulist.menu_panda : ""}</span>
                      </td>
                      <td class="align-middle text-center">
                        <img name="menu_picture" src="${myMenulist.menu_picture}" alt="profile_image" class=" border-radius-round " style="height: 50px;width: auto;max-width: 75px;object-fit: cover;">
                        <span name="menu_pictureName" class="text-secondary text-xs font-weight-bold">${myMenulist.menu_picture.split("/").pop().split("-").pop()}</span>
                      </td>
                      <td class="align-middle text-center">
                        <span name="menu_editdate" class="text-secondary text-xs font-weight-bold">${myMenulist.created_at}</span>
                      </td>
                      <td class=" align-middle text-end gx-1">
                        <button type="button" class="editMenu btn btn-outline-primary  "
                                data-bs-toggle="modal" data-bs-target="#myModal_V2" title="編輯">
                                <i class="bi bi-pencil-square"></i>
                              </button>
                              <button type="button" class="delMenu btn btn-outline-warning "
                                data-bs-toggle="modal" data-bs-target="#myModal_V3" title="刪除">
                                <i class="bi bi-trash3-fill"></i>
                              </button>
                      </td>
                    </tr>`
              )

            })

            // 換成資料庫抓到的logo圖像路徑(如果有的話)
            if (Mlist[1][0].shop_logo_img) {
              $('.avatar img').prop('src', '../' + Mlist[1][0].shop_logo_img);
            }

            // 將左側 menu 的文字改成店名
            $('#welcomeText').text(`Welcome! ${Mlist[1][0].shop_name.split(" ")[0]}`);
          }
        })

      }

      //獲得Tr內容
      function getTrData(row) {
        const meid = row.find("span[name='menu_id']").text();
        const mename = row.find("span[name='menu_name']").text();
        const metype = row.find("span[name='menu_type']").text();
        const meprice = row.find("span[name='menu_price']").text();
        const meuber = row.find("span[name='menu_uber']").text();
        const mepanda = row.find("span[name='menu_panda']").text();
        const mepicture = row.find("img[name='menu_picture']").attr('src');
        const mepictureName = row.find("span[name='menu_pictureName']").text();
        //const meeditdate = row.find("span[name='menu_editdate']").text();

        return {
          meid,
          mename,
          metype,
          meprice,
          meuber,
          mepanda,
          mepicture,
          mepictureName,
        };
      }

      //編輯按鈕
      function getEditMenu() {
        $('tbody').on('click', '.editMenu', function () {
          console.log('edit edit')
          var row = $(this).closest('tr');
          var trData = getTrData(row);
          console.log(trData);

          $('#editName').val(trData.mename);
          $('#editPrice').val(trData.meprice);
          $('#editUber').val(trData.meuber);
          $('#editPanda').val(trData.mepanda);
          $('#editType').val(trData.metype);
          $('#editId').text(trData.meid);
          $('#editImg').attr("src", trData.mepicture);
        });
      }

      //刪除按鈕
      function getDelMenu() {
        $('tbody').on('click', '.delMenu', function () {
          console.log('delete delete')
          var row = $(this).closest('tr');
          var trData = getTrData(row);
          console.log(trData);

          $('#delName').text(trData.mename);
          $('#delId').text(trData.meid);
        });
      }




      getMenuList()
      getDelMenu()
      getEditMenu()
    });

  </script>
  <!-- 圖片insert -->
  <script src="/js/menu/menu_img.js"></script>
  <!-- CSV insert -->
  <script src="/js/menu/menu_csv.js"></script>
  <!-- 時間排序 -->
  <script src="/js/menu/menu_getMenuListDESC.js"></script>

  <!-- 菜單編輯update&dele -->
  <script src="/js/menu/menu_button.js"></script>
  <script src="/js/menu/menu_update.js"></script>
  <script src="/js/backstage.js"></script>
  <script>
    // getMenuList();
    // getEditMenu()
    // getDelMenu()
  </script>
</body>

</html>